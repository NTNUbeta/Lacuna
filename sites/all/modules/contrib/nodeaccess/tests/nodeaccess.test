<?php

/**
 * @file
 * Tests for the nodeaccess module.
 */

/**
 * Tests the functionality of the nodeaccess module.
 */
class NodeaccesssTestCase extends DrupalWebTestCase {

  /**
   * Enable the nodeaccess module.
   */
  public function setUp() {
    parent::setUp('nodeaccess');
  }

  /**
   * Provide some information about this test case.
   */
  public static function getInfo() {
    return array(
      'name' => 'General Nodeaccess functionality',
      'description' => 'Tests the Nodeaccess module.',
      'group' => 'Nodeaccess',
    );
  }

  /**
   * Make sure the 'Grant' tab is available from the node view when appropriate.
   * @test
   * @todo Don't use variable_set() directly here, once #2037899 has been done.
   */
  public function testGrantTabVisbility() {
    // Create a test user, and a node with nodeaccess enabled for its type.
    $user = $this->drupalCreateUser(array('grant node permissions'));
    $node = $this->drupalCreateNode();
    variable_set('nodeaccess-types', array($node->type => TRUE));

    // First, before logging in, we shouldn't see a link.
    $this->drupalGet("node/{$node->nid}");
    $this->assertNoLinkByHref("/node/{$node->nid}/grant");

    // Log in and the grant tab should appear.
    $this->drupalLogin($user);
    $this->drupalGet("node/{$node->nid}");
    $this->assertLinkByHref("/node/{$node->nid}/grant");

    // Disable nodeaccess for this content type, and the tab should be gone.
    variable_set('nodeaccess-types', array());
    $this->drupalGet("node/{$node->nid}");
    $this->assertNoLinkByHref("/node/{$node->nid}/grant");

  }

}
