<?php

/*
*   Implements hook_form_alter().  Shows the appropriate document
*   content field based on the selected document type.
*/

function lacuna_pdf_document_form_document_node_form_alter( &$form, &$form_state, &$form_id ) {

    $doc_type_selector = ':input[name^="field_doc_type"]';
    $form['field_doc_text']['#states'] = array(
        'visible' => array(
            $doc_type_selector => array(
                'value' => '0',
            ),
        ),
    );

    $form['field_doc_pdf']['#states'] = array(
        'visible' => array(
            $doc_type_selector => array(
                'value' => '1',
            ),
        ),
    );

}


/*
*   Implements hook_preprocess_node().  Adds a 'pdf-document' class
*   to nodes with PDF content, and remove the PDF field if document
*   type is set to text.
*/

function lacuna_pdf_document_preprocess_node( &$node ) {

    if ( $node['type'] === 'document' ) {
        $lang = $node['language'];
        $is_pdf = $node['field_doc_type'][$lang][0]['value'];
        if ( $is_pdf ) {
            
            $node['classes_array'][] = 'pdf-document';
            hide($node['content']['field_doc_text']);
        
        } else {

            hide($node['content']['field_doc_pdf']);

        }
    }

}
